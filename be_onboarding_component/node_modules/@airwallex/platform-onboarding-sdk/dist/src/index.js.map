{"version":3,"file":"index.js","names":["ENV_HOST","staging","demo","prod","SDK_VERSION","getGatewayUrl","env","STATIC_FILE_NAME","createScript","gatewayUrl","script","document","createElement","src","parentDom","head","body","Error","appendChild","loadScript","window","AirwallexOnboarding","MAX_RETRY_COUNT","RETRY_COUNT","sleep","Promise","resolve","setTimeout","tryToResolve","scriptUrl","querySelector","reject","addEventListener","remove","init","options","errMsg","console","error","type"],"sources":["../../src/index.ts"],"sourcesContent":["import {\n  Element,\n  InitOptions,\n  ElementType,\n  AirwallexEnv,\n  AirwallexOnboarding,\n  ElementOptions,\n  ElementOptionsTypeMap,\n  init as initFn,\n  createElement as createElementFn,\n} from '../types';\n\nexport type { ElementType, InitOptions, Element, ElementOptions };\n\ndeclare global {\n  interface Window {\n    AirwallexOnboarding: AirwallexOnboarding;\n  }\n}\n\nconst ENV_HOST = {\n  staging: 'static-staging.airwallex.com/widgets/sdk/onboarding',\n  demo: 'static-demo.airwallex.com/widgets/sdk/onboarding',\n  prod: 'static.airwallex.com/widgets/sdk/onboarding',\n};\n\nconst SDK_VERSION = 'v1';\n\nexport const getGatewayUrl = (env: AirwallexEnv): string => `https://${ENV_HOST[env] || ENV_HOST.prod}/${SDK_VERSION}/`;\nconst STATIC_FILE_NAME = 'index.js';\n\nconst createScript = (gatewayUrl: string): HTMLScriptElement => {\n  const script = document.createElement('script');\n  script.src = `${gatewayUrl}${STATIC_FILE_NAME}`;\n\n  const parentDom = document.head || document.body;\n\n  if (!parentDom) {\n    throw new Error('Airwallex Onboarding SDK scripts requires a <head> or <body> html element in order to be loaded.');\n  }\n\n  parentDom.appendChild(script);\n\n  return script;\n};\n\nexport const loadScript = async ({ env }: { env?: AirwallexEnv }) => {\n  if (typeof window === 'undefined') {\n    return null;\n  }\n\n  if (window.AirwallexOnboarding) {\n    return window.AirwallexOnboarding;\n  }\n\n  const MAX_RETRY_COUNT = 3;\n  let RETRY_COUNT = 0;\n  const sleep = () => new Promise((resolve) => window.setTimeout(resolve, 500));\n\n  const tryToResolve = async (): Promise<AirwallexOnboarding> => {\n    const scriptUrl = getGatewayUrl(env || 'prod');\n    const script: HTMLScriptElement =\n      document.querySelector(`script[src=\"${scriptUrl}\"], script[src=\"${scriptUrl}/\"]`) || createScript(scriptUrl);\n\n    return new Promise((resolve, reject) => {\n      script.addEventListener('load', () => {\n        if (window.AirwallexOnboarding) {\n          resolve(window.AirwallexOnboarding);\n        } else {\n          reject(new Error('Failed to load Airwallex Onboarding SDK on load event.'));\n        }\n      });\n\n      script.addEventListener('error', () => {\n        reject(new Error('Failed to load Airwallex Onboarding SDK scripts.'));\n        script.remove && script.remove();\n      });\n    });\n  };\n\n  while (RETRY_COUNT < MAX_RETRY_COUNT) {\n    try {\n      return await tryToResolve();\n    } catch (error) {\n      RETRY_COUNT++;\n      await sleep();\n    }\n  }\n\n  return null;\n};\n\nexport const init: typeof initFn = async (options: InitOptions) => {\n  await loadScript(options);\n\n  if (!window.AirwallexOnboarding) {\n    const errMsg = 'Failed when initialize Airwallex platform onboarding SDK';\n    console.error(errMsg);\n    return Promise.reject(new Error(errMsg));\n  } else {\n    return window.AirwallexOnboarding.init(options);\n  }\n};\n\nexport const createElement: typeof createElementFn = (\n  type: ElementType,\n  options: ElementOptionsTypeMap[ElementType]\n) => {\n  if (!window.AirwallexOnboarding) {\n    console.error('Please initialize Airwallex platform onboarding SDK before createElement()');\n    return null;\n  } else {\n    return window.AirwallexOnboarding.createElement(type, options);\n  }\n};\n"],"mappings":"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"}